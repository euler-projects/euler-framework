-- ------------------------------------
-- 用户管理与安全验证模块
-- ------------------------------------

-- 用户表
CREATE TABLE SYS_USER
    (
        ID VARCHAR(36) NOT NULL,
        USERNAME VARCHAR(255) NOT NULL,
        EMAIL VARCHAR(255) NULL,
        MOBILE VARCHAR(255) NULL,
        PASSWORD VARCHAR(255) NOT NULL,
        ACCOUNT_NON_EXPIRED bit NOT NULL,
        ACCOUNT_NON_LOCKED bit NOT NULL,
        CREDENTIALS_NON_EXPIRED bit NOT NULL,
        ENABLED bit NOT NULL,
        ROOT bit NULL,
        PRIMARY KEY (ID),
        CONSTRAINT UK_SYS_USER_USERNAME UNIQUE (USERNAME),
        CONSTRAINT UK_SYS_USER_EMAIL UNIQUE (EMAIL),
        CONSTRAINT UK_SYS_USER_MOBILE UNIQUE (MOBILE)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 权限组表
CREATE TABLE SYS_GROUP
    (
        ID VARCHAR(36)  NOT NULL,
        NAME VARCHAR(255) NOT NULL,
        DESCRIPTION VARCHAR(255) NULL,
        PRIMARY KEY (ID),
        CONSTRAINT UK_SYS_GROUP UNIQUE (NAME)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 权限表
CREATE TABLE SYS_AUTHORITY
    (
        AUTHORITY VARCHAR(255) NOT NULL,
        NAME VARCHAR(255) NOT NULL,
        DESCRIPTION VARCHAR(255) NULL,
        PRIMARY KEY (AUTHORITY),
        CONSTRAINT UK_SYS_AUTHORITY UNIQUE (NAME)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 用户-权限组关系表
CREATE TABLE SYS_USER_GROUP
    (
        USER_ID  VARCHAR(36) NOT NULL,
        GROUP_ID VARCHAR(36) NOT NULL,
        PRIMARY KEY (USER_ID, GROUP_ID),
        CONSTRAINT FK_SYS_USER_GROUP_UID FOREIGN KEY (USER_ID) REFERENCES SYS_USER (ID),
        CONSTRAINT FK_SYS_USER_GROUP_GID FOREIGN KEY (GROUP_ID) REFERENCES SYS_GROUP (ID)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 权限组-权限关系表
CREATE TABLE SYS_GROUP_AUTHORITY
    (
        GROUP_ID  VARCHAR(36)  NOT NULL,
        AUTHORITY VARCHAR(255) NOT NULL,
        PRIMARY KEY (GROUP_ID, AUTHORITY),
        CONSTRAINT FK_SYS_GROUP_AUTHORITY_GID FOREIGN KEY (GROUP_ID) REFERENCES SYS_GROUP (ID),
        CONSTRAINT FK_SYS_GROUP_AUTHORITY_AID FOREIGN KEY (AUTHORITY) REFERENCES SYS_AUTHORITY (AUTHORITY)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 插入根用户
INSERT INTO SYS_USER (ID, USERNAME, EMAIL, MOBILE, PASSWORD, ACCOUNT_NON_EXPIRED, ACCOUNT_NON_LOCKED, CREDENTIALS_NON_EXPIRED, ENABLED, ROOT)
VALUES ('00000000-0000-0000-0000-000000000000', 'root', null, null, 'NaN', true, true, true, true, true);
-- 插入默认管理员用户
INSERT INTO SYS_USER (ID, USERNAME, EMAIL, MOBILE, PASSWORD, ACCOUNT_NON_EXPIRED, ACCOUNT_NON_LOCKED, CREDENTIALS_NON_EXPIRED, ENABLED, ROOT)
VALUES (uuid(), 'admin', null, null, 'NaN', true, true, true, true, null);
-- 插入默认管理员权限组
INSERT INTO SYS_GROUP (ID, DESCRIPTION, NAME) VALUES ('00000000-0000-0000-0000-000000000000', '管理员', '管理员');
-- 插入默认管理员权限
INSERT INTO SYS_AUTHORITY (AUTHORITY, DESCRIPTION, NAME) VALUES ('ADMIN', '管理员', '管理员');
-- 插入默认管理员与默认管理员权限组的关系映射
INSERT INTO SYS_USER_GROUP (USER_ID, GROUP_ID) VALUES (
(SELECT ID FROM SYS_USER WHERE USERNAME = 'admin'), '00000000-0000-0000-0000-000000000000');
-- 插入默认管理员权限组与默认管理员权限的关系映射
INSERT INTO SYS_GROUP_AUTHORITY (GROUP_ID, AUTHORITY) VALUES ('00000000-0000-0000-0000-000000000000', 'ADMIN');


-- ------------------------------------
-- 基础配置、数据字典、文件上下载模块
-- ------------------------------------

-- 配置信息表
CREATE TABLE SYS_CONF
    (
        CONF_KEY VARCHAR(255) NOT NULL COMMENT '配置信息键值',
        CONF_DESCRIPTION VARCHAR(255) COMMENT '配置信息说明',
        ENABLED bit NOT NULL COMMENT '是否生效',
        CONF_VALUE VARCHAR(255) COMMENT '配置值',
        PRIMARY KEY (CONF_KEY)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='配置信息表';

-- 上传文件信息表
CREATE TABLE BASIC_UPLOADED_FILE
    (
        ID VARCHAR(36) NOT NULL COMMENT '上传文件ID',
        ARCHIVED_FILENAME VARCHAR(255) NOT NULL COMMENT '上传后文件名',
        ARCHIVED_PATH_SUFFIX VARCHAR(255) COMMENT '上传保存路径前缀',
        EXTENSION VARCHAR(255) COMMENT '文件扩展名',
        FILE_BYTE_SIZE bigint NOT NULL COMMENT '文件大小',
        MD5 VARCHAR(255) NOT NULL COMMENT '文件MD5',
        ORIGINAL_FILENAME VARCHAR(255) NOT NULL COMMENT '原始文件名',
        UPLOADED_DATE DATETIME NOT NULL COMMENT '上传时刻',
        UPLOADED_USER_ID VARCHAR(255) NOT NULL COMMENT '上传用户ID',
        PRIMARY KEY (ID),
        CONSTRAINT UK_BASIC_UPLOADED_FILE_1 UNIQUE (ARCHIVED_FILENAME)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='上传文件记录表';
